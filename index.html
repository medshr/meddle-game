<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meddle - The Medical Disease Guessing Game</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827; /* Tailwind gray-900 */
        }
        /* Styles for the flip animation */
        .cell-wrapper {
            perspective: 1000px;
        }
        .feedback-cell {
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s;
        }
        .feedback-cell.flipped {
            transform: rotateX(180deg);
        }
        .cell-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0.75rem;
            border-radius: 0.375rem;
            font-weight: 500;
            color: white;
            text-align: center;
        }
        .cell-front {
            background-color: #374151; /* gray-700 */
        }
        .cell-back {
            transform: rotateX(180deg);
        }
        /* Custom styles for autocomplete */
        .autocomplete-items {
            position: absolute;
            border: 1px solid #4B5563; /* gray-600 */
            border-top: none;
            z-index: 99;
            top: 100%;
            left: 0;
            right: 0;
            max-height: 200px;
            overflow-y: auto;
            background-color: #1F2937; /* gray-800 */
        }
        .autocomplete-items div {
            padding: 10px;
            cursor: pointer;
            border-bottom: 1px solid #374151; /* gray-700 */
        }
        .autocomplete-items div:hover,
        .autocomplete-active {
            background-color: #3B82F6 !important; /* blue-500 */
            color: #ffffff;
        }
        .correct { background-color: #10B981; /* Emerald-500 */ }
        .incorrect { background-color: #EF4444; /* Red-500 */ }
    </style>
</head>
<body class="text-white antialiased">

    <div class="container mx-auto p-4 md:p-8 max-w-5xl">
        <!-- Header -->
        <header class="text-center mb-6">
            <h1 class="text-4xl md:text-5xl font-bold tracking-tight text-blue-400">Meddle</h1>
            <p class="text-lg text-gray-400 mt-2">The MedShr Disease Guessing Game</p>
        </header>
        
        <!-- Game Instructions -->
        <div class="bg-gray-800 p-4 rounded-lg mb-6 text-sm text-gray-300">
            <h2 class="font-semibold text-lg mb-2 text-white">How to Play</h2>
            <p>Guess the disease in 8 tries. After each guess, you'll see feedback on the attributes.</p>
            <ul class="list-disc list-inside mt-2 space-y-1">
                <li><span class="inline-block w-4 h-4 rounded bg-emerald-500 mr-2"></span><span class="font-semibold">Green</span> indicates a correct attribute.</li>
                <li><span class="inline-block w-4 h-4 rounded bg-red-500 mr-2"></span><span class="font-semibold">Red</span> indicates an incorrect attribute.</li>
                <li>For 'Decade Discovered', <span class="font-bold text-white">▲</span> means the target decade is later, and <span class="font-bold text-white">▼</span> means it's earlier.</li>
            </ul>
        </div>

        <!-- Game Interface -->
        <main id="game-board" class="bg-gray-800 p-6 rounded-xl shadow-2xl">
            <!-- Input Form -->
            <div class="relative mb-4">
                <input type="text" id="guess-input" placeholder="Type a disease name..." class="w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-3 text-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition">
                <div id="autocomplete-list" class="autocomplete-items rounded-b-lg"></div>
            </div>
            <button id="guess-button" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg text-lg transition duration-300 ease-in-out transform hover:scale-105">Guess</button>
            <p class="text-center text-gray-400 mt-2 text-sm">Guesses remaining: <span id="guesses-left">8</span></p>
            
            <!-- Guesses Table -->
            <div class="mt-6 overflow-x-auto">
                <table class="w-full text-center text-sm md:text-base border-separate border-spacing-1">
                    <thead class="border-b-2 border-gray-600">
                         <tr>
                            <th class="p-2 font-semibold">Guess</th>
                            <th class="p-2 font-semibold">Specialty</th>
                            <th class="p-2 font-semibold">Causation</th>
                            <th class="p-2 font-semibold">System</th>
                            <th class="p-2 font-semibold">Acuity</th>
                            <th class="p-2 font-semibold">Decade Discovered</th>
                        </tr>
                    </thead>
                    <tbody id="guesses-container">
                        <!-- Guesses will be dynamically inserted here -->
                    </tbody>
                </table>
            </div>
        </main>
        
        <!-- Win/Loss Modal -->
        <div id="modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50 hidden">
            <div class="bg-gray-800 rounded-xl p-8 text-center max-w-sm w-full shadow-lg transform transition-all scale-95 opacity-0" id="modal-content">
                <h2 id="modal-title" class="text-3xl font-bold mb-4"></h2>
                <p id="modal-body" class="text-lg text-gray-300 mb-6"></p>
                <div id="share-grid-container" class="mb-4 font-mono text-lg leading-tight"></div>
                <button id="share-button" class="w-full bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-4 rounded-lg text-lg transition duration-300 mb-2 hidden">Copy Results</button>
                <button id="play-again-button" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg text-lg transition duration-300">Play Again</button>
            </div>
        </div>
    </div>
    
    <footer class="text-center text-gray-500 text-sm mt-8 pb-4">
        <p>A MedShr Production | Inspired by Wordle</p>
    </footer>

    <script>
        const diseases = [
            { name: "Influenza", specialty: "Infectious Disease", causation: "Viral", system: "Respiratory", acuity: "Acute", decade: 1930 },
            { name: "Hypertension", specialty: "Cardiology", causation: "Idiopathic", system: "Circulatory", acuity: "Chronic", decade: 1890 },
            { name: "Diabetes Mellitus Type 1", specialty: "Endocrinology", causation: "Autoimmune", system: "Endocrine", acuity: "Chronic", decade: 1880 },
            { name: "Asthma", specialty: "Pulmonology", causation: "Inflammatory", system: "Respiratory", acuity: "Chronic", decade: 1870 },
            { name: "Alzheimer's Disease", specialty: "Neurology", causation: "Degenerative", system: "Nervous", acuity: "Chronic", decade: 1900 },
            { name: "Tuberculosis", specialty: "Infectious Disease", causation: "Bacterial", system: "Respiratory", acuity: "Chronic", decade: 1880 },
            { name: "HIV/AIDS", specialty: "Infectious Disease", causation: "Viral", system: "Immune", acuity: "Chronic", decade: 1980 },
            { name: "Malaria", specialty: "Infectious Disease", causation: "Parasitic", system: "Circulatory", acuity: "Acute", decade: 1880 },
            { name: "Parkinson's Disease", specialty: "Neurology", causation: "Degenerative", system: "Nervous", acuity: "Chronic", decade: 1810 },
            { name: "Rheumatoid Arthritis", specialty: "Rheumatology", causation: "Autoimmune", system: "Skeletal", acuity: "Chronic", decade: 1800 },
            { name: "Chickenpox", specialty: "Infectious Disease", causation: "Viral", system: "Integumentary", acuity: "Acute", decade: 1550 },
            { name: "Epilepsy", specialty: "Neurology", causation: "Neurological", system: "Nervous", acuity: "Chronic", decade: 1700 },
            { name: "Cystic Fibrosis", specialty: "Pulmonology", causation: "Genetic", system: "Respiratory", acuity: "Chronic", decade: 1930 },
            { name: "Multiple Sclerosis", specialty: "Neurology", causation: "Autoimmune", system: "Nervous", acuity: "Chronic", decade: 1860 },
            { name: "Crohn's Disease", specialty: "Gastroenterology", causation: "Autoimmune", system: "Digestive", acuity: "Chronic", decade: 1930 },
            { name: "Gout", specialty: "Rheumatology", causation: "Metabolic", system: "Skeletal", acuity: "Acute", decade: 1680 },
            { name: "Psoriasis", specialty: "Dermatology", causation: "Autoimmune", system: "Integumentary", acuity: "Chronic", decade: 1840 },
            { name: "COVID-19", specialty: "Infectious Disease", causation: "Viral", system: "Respiratory", acuity: "Acute", decade: 2010 },
            { name: "Lupus", specialty: "Rheumatology", causation: "Autoimmune", system: "Immune", acuity: "Chronic", decade: 1820 },
            { name: "Endometriosis", specialty: "Gynecology", causation: "Hormonal", system: "Reproductive", acuity: "Chronic", decade: 1860 },
            { name: "Myocardial Infarction", specialty: "Cardiology", causation: "Ischemic", system: "Circulatory", acuity: "Acute", decade: 1910 },
            { name: "Peptic Ulcer Disease", specialty: "Gastroenterology", causation: "Bacterial", system: "Digestive", acuity: "Chronic", decade: 1980 },
            { name: "Sickle Cell Anemia", specialty: "Hematology", causation: "Genetic", system: "Circulatory", acuity: "Chronic", decade: 1910 },
            { name: "Graves' Disease", specialty: "Endocrinology", causation: "Autoimmune", system: "Endocrine", acuity: "Chronic", decade: 1830 },
            { name: "Celiac Disease", specialty: "Gastroenterology", causation: "Autoimmune", system: "Digestive", acuity: "Chronic", decade: 1880 },
            { name: "Poliomyelitis", specialty: "Infectious Disease", causation: "Viral", system: "Nervous", acuity: "Acute", decade: 1780 },
            { name: "Measles", specialty: "Infectious Disease", causation: "Viral", system: "Immune", acuity: "Acute", decade: 900 },
            { name: "Huntington's Disease", specialty: "Neurology", causation: "Genetic", system: "Nervous", acuity: "Chronic", decade: 1870 },
            { name: "Dengue Fever", specialty: "Infectious Disease", causation: "Viral", system: "Circulatory", acuity: "Acute", decade: 1770 },
            { name: "Chronic Kidney Disease", specialty: "Nephrology", causation: "Degenerative", system: "Urinary", acuity: "Chronic", decade: 1820 },
            { name: "Osteoporosis", specialty: "Endocrinology", causation: "Metabolic", system: "Skeletal", acuity: "Chronic", decade: 1830 },
            { name: "Glaucoma", specialty: "Ophthalmology", causation: "Degenerative", system: "Nervous", acuity: "Chronic", decade: 1850 },
            { name: "Stroke", specialty: "Neurology", causation: "Ischemic", system: "Nervous", acuity: "Acute", decade: 1650 },
            { name: "Appendicitis", specialty: "General Surgery", causation: "Inflammatory", system: "Digestive", acuity: "Acute", decade: 1880 },
            { name: "Hepatitis C", specialty: "Infectious Disease", causation: "Viral", system: "Digestive", acuity: "Chronic", decade: 1980 },
            { name: "Rabies", specialty: "Infectious Disease", causation: "Viral", system: "Nervous", acuity: "Acute", decade: 1880 },
            { name: "Migraine", specialty: "Neurology", causation: "Neurological", system: "Nervous", acuity: "Acute", decade: 1860 },
            { name: "Scurvy", specialty: "Internal Medicine", causation: "Nutritional", system: "Integumentary", acuity: "Acute", decade: 1740 },
            { name: "Acne Vulgaris", specialty: "Dermatology", causation: "Hormonal", system: "Integumentary", acuity: "Chronic", decade: 1800 },
            { name: "Fibromyalgia", specialty: "Rheumatology", causation: "Idiopathic", system: "Skeletal", acuity: "Chronic", decade: 1900 },
            { name: "Eczema", specialty: "Dermatology", causation: "Inflammatory", system: "Integumentary", acuity: "Chronic", decade: 1800 },
            { name: "Down Syndrome", specialty: "Pediatrics", causation: "Genetic", system: "Nervous", acuity: "Chronic", decade: 1860 },
            { name: "Depression", specialty: "Psychiatry", causation: "Neurological", system: "Nervous", acuity: "Chronic", decade: 1800 },
            { name: "Typhoid Fever", specialty: "Infectious Disease", causation: "Bacterial", system: "Digestive", acuity: "Acute", decade: 1880 },
            { name: "Meningitis", specialty: "Infectious Disease", causation: "Bacterial", system: "Nervous", acuity: "Acute", decade: 1800 }
        ];

        const MAX_GUESSES = 8;
        let targetDisease, guessesLeft, gameOver;
        let guessHistory = [];

        // DOM Elements
        const guessInput = document.getElementById('guess-input');
        const guessButton = document.getElementById('guess-button');
        const guessesContainer = document.getElementById('guesses-container');
        const guessesLeftSpan = document.getElementById('guesses-left');
        const modal = document.getElementById('modal');
        const modalContent = document.getElementById('modal-content');
        const modalTitle = document.getElementById('modal-title');
        const modalBody = document.getElementById('modal-body');
        const shareButton = document.getElementById('share-button');
        const shareGridContainer = document.getElementById('share-grid-container');
        const autocompleteList = document.getElementById('autocomplete-list');
        
        let activeAutocompleteIndex = -1;

        function initializeGame() {
            targetDisease = diseases[Math.floor(Math.random() * diseases.length)];
            guessesLeft = MAX_GUESSES;
            gameOver = false;
            guessHistory = [];
            
            console.log("Answer:", targetDisease.name);

            guessesContainer.innerHTML = '';
            guessInput.value = '';
            guessInput.disabled = false;
            guessButton.disabled = false;
            guessesLeftSpan.textContent = guessesLeft;
            hideModal();
        }

        function handleGuess() {
            if (gameOver) return;

            const guessName = guessInput.value.trim();
            const guessedDisease = diseases.find(d => d.name.toLowerCase() === guessName.toLowerCase());

            if (!guessedDisease) {
                showModal("Invalid Guess", "That disease is not in our list. Please choose one from the autocomplete suggestions.", true);
                return;
            }

            guessesLeft--;
            guessesLeftSpan.textContent = guessesLeft;
            
            const results = {
                name: guessedDisease.name === targetDisease.name,
                specialty: guessedDisease.specialty === targetDisease.specialty,
                causation: guessedDisease.causation === targetDisease.causation,
                system: guessedDisease.system === targetDisease.system,
                acuity: guessedDisease.acuity === targetDisease.acuity,
                decade: guessedDisease.decade === targetDisease.decade,
                decadeComparison: targetDisease.decade - guessedDisease.decade
            };
            guessHistory.push(results);
            
            displayGuessRow(guessedDisease, results);
            
            guessInput.value = '';
            closeAutocomplete();

            if (results.name) {
                setTimeout(() => endGame(true), 6 * 150);
            } else if (guessesLeft === 0) {
                 setTimeout(() => endGame(false), 6 * 150);
            }
        }

        function displayGuessRow(guessedDisease, results) {
            const newRow = document.createElement('tr');
            const properties = ['name', 'specialty', 'causation', 'system', 'acuity', 'decade'];

            properties.forEach((prop, index) => {
                const td = document.createElement('td');
                td.className = 'cell-wrapper';

                const cellFlipper = document.createElement('div');
                cellFlipper.className = 'feedback-cell relative h-16 md:h-14';

                let contentOnBack = guessedDisease[prop];
                 if (prop === 'decade') {
                    contentOnBack = `${guessedDisease[prop]}s`; // Add 's' to decade
                    if (!results.decade) {
                        contentOnBack += ` <span class="font-bold text-lg ml-1">${results.decadeComparison > 0 ? '▲' : '▼'}</span>`;
                    }
                }

                const frontFace = document.createElement('div');
                frontFace.className = 'cell-face cell-front';
                frontFace.innerHTML = (prop === 'decade') ? `${guessedDisease[prop]}s` : guessedDisease[prop];

                const backFace = document.createElement('div');
                backFace.className = 'cell-face cell-back';
                backFace.classList.add(results[prop] ? 'correct' : 'incorrect');
                backFace.innerHTML = contentOnBack;

                cellFlipper.appendChild(frontFace);
                cellFlipper.appendChild(backFace);
                
                td.appendChild(cellFlipper);
                newRow.appendChild(td);
                
                setTimeout(() => {
                    cellFlipper.classList.add('flipped');
                }, index * 150);
            });
            guessesContainer.appendChild(newRow);
        }

        function endGame(isWin) {
            gameOver = true;
            guessInput.disabled = true;
            guessButton.disabled = true;

            displayShareableResult();

            if (isWin) {
                showModal("You got it!", `The disease was <strong class="text-blue-400">${targetDisease.name}</strong>.`);
            } else {
                showModal("Game Over!", `The correct disease was <strong class="text-blue-400">${targetDisease.name}</strong>.`);
            }
        }
        
        function displayShareableResult() {
            shareGridContainer.innerHTML = '';
            guessHistory.forEach(guess => {
                const row = document.createElement('div');
                const properties = ['name', 'specialty', 'causation', 'system', 'acuity', 'decade'];
                let rowString = '';
                properties.forEach(prop => {
                    if (prop === 'decade') {
                        if (guess.decade) rowString += '🟩';
                        else if (guess.decadeComparison > 0) rowString += '🔼';
                        else rowString += '🔽';
                    } else {
                        rowString += guess[prop] ? '🟩' : '🟥';
                    }
                });
                row.textContent = rowString;
                shareGridContainer.appendChild(row);
            });
            shareButton.classList.remove('hidden');
        }

        function showModal(title, body, isWarning = false) {
            modalTitle.textContent = title;
            modalBody.innerHTML = body;

            const playAgainButton = document.getElementById('play-again-button');
            
            playAgainButton.textContent = isWarning ? "Close" : "Play Again";
            shareButton.style.display = isWarning ? 'none' : 'block';

            // Clone the button to remove old event listeners, then replace it in the DOM
            const newPlayAgainButton = playAgainButton.cloneNode(true);
            playAgainButton.parentNode.replaceChild(newPlayAgainButton, playAgainButton);

            if (isWarning) {
                newPlayAgainButton.addEventListener('click', hideModal, { once: true });
            } else {
                newPlayAgainButton.addEventListener('click', initializeGame, { once: true });
            }
            
            modal.classList.remove('hidden');
            setTimeout(() => modalContent.classList.remove('scale-95', 'opacity-0'), 10);
        }

        function hideModal() {
            modalContent.classList.add('scale-95', 'opacity-0');
            setTimeout(() => modal.classList.add('hidden'), 300);
        }
        
        function copyResultsToClipboard() {
            const guessCount = guessHistory.length;
            const didWin = guessHistory[guessHistory.length - 1].name;
            let shareText = `Meddle (${didWin ? guessCount : 'X'}/${MAX_GUESSES})\n\n`;
            shareText += Array.from(shareGridContainer.children).map(row => row.textContent).join('\n');
            
            navigator.clipboard.writeText(shareText).then(() => {
                const originalText = shareButton.textContent;
                shareButton.textContent = 'Copied!';
                setTimeout(() => { shareButton.textContent = originalText; }, 2000);
            }).catch(err => {
                console.error('Failed to copy: ', err);
            });
        }

        function handleAutocomplete(e) {
            const value = e.target.value;
            closeAutocomplete();
            if (!value) return;

            const filteredDiseases = diseases.filter(d => d.name.toLowerCase().startsWith(value.toLowerCase()));
            
            filteredDiseases.forEach((disease, i) => {
                const item = document.createElement('div');
                item.innerHTML = `<strong>${disease.name.substr(0, value.length)}</strong>${disease.name.substr(value.length)}`;
                item.addEventListener('click', () => {
                    guessInput.value = disease.name;
                    closeAutocomplete();
                });
                autocompleteList.appendChild(item);
            });
        }
        
        function closeAutocomplete() {
            autocompleteList.innerHTML = '';
            activeAutocompleteIndex = -1;
        }

        function updateActiveAutocomplete() {
            const items = autocompleteList.getElementsByTagName('div');
            for (let i = 0; i < items.length; i++) {
                items[i].classList.remove('autocomplete-active');
            }
            if (activeAutocompleteIndex > -1) {
                items[activeAutocompleteIndex].classList.add('autocomplete-active');
            }
        }

        // Event Listeners
        guessButton.addEventListener('click', handleGuess);
        shareButton.addEventListener('click', copyResultsToClipboard);
        
        guessInput.addEventListener('input', handleAutocomplete);
        guessInput.addEventListener('keydown', (e) => {
            const items = autocompleteList.getElementsByTagName('div');
            if (e.key === 'ArrowDown') {
                activeAutocompleteIndex++;
                if (activeAutocompleteIndex >= items.length) activeAutocompleteIndex = 0;
                updateActiveAutocomplete();
            } else if (e.key === 'ArrowUp') {
                activeAutocompleteIndex--;
                if (activeAutocompleteIndex < 0) activeAutocompleteIndex = items.length - 1;
                updateActiveAutocomplete();
            } else if (e.key === 'Enter') {
                e.preventDefault(); 
                if (activeAutocompleteIndex > -1) {
                    items[activeAutocompleteIndex].click();
                } else {
                    handleGuess();
                }
            } else if (e.key === 'Escape') {
                closeAutocomplete();
            }
        });

        document.addEventListener('click', (e) => {
            if (e.target !== guessInput) closeAutocomplete();
        });

        // Initial game start
        initializeGame();
    </script>
</body>
</html>

